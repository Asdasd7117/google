<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>نوافذ بحث عبر البروكسي</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f5f7fb; }
    header { position: sticky; top: 0; background: #fff; padding: 12px 16px; box-shadow: 0 2px 10px rgba(0,0,0,.06); z-index: 10; }
    h1 { margin: 0; font-size: 18px; }
    .controls { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    input[type="text"] { flex: 1; min-width: 240px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    button { padding: 10px 16px; border: 0; border-radius: 10px; cursor: pointer; font-size: 14px; box-shadow: 0 2px 8px rgba(0,0,0,.08); }
    .btn { background: #4caf50; color: #fff; }
    .btn:hover { filter: brightness(0.95); }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 12px; padding: 16px; }
    .card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,.06); display: flex; flex-direction: column; }
    .card-header { padding: 8px 12px; display: flex; gap: 8px; align-items: center; border-bottom: 1px solid #eee; }
    .card-header input { flex: 1; min-width: 100px; }
    .card-header button { background: #2196f3; color: white; }
    iframe { width: 100%; height: 540px; border: 0; }
    .empty { text-align: center; color: #777; padding: 40px 0; }
  </style>
</head>
<body>
  <header>
    <h1>نوافذ بحث عبر البروكسي</h1>
    <div class="controls">
      <input id="globalQuery" type="text" placeholder="ابحث هنا... (يُستخدم عند إنشاء نافذة جديدة)" />
      <button class="btn" id="addWindow">فتح نافذة جديدة</button>
      <div id="count" style="margin-inline-start:auto;color:#555;">عدد النوافذ: <b id="cnum">0</b></div>
    </div>
  </header>

  <main>
    <div class="grid" id="grid"></div>
    <div class="empty" id="empty">لا توجد نوافذ بعد. اكتب كلمة بحث واضغط "فتح نافذة جديدة".</div>
  </main>

  <script>
    const grid = document.getElementById("grid");
    const counter = document.getElementById("cnum");
    const empty = document.getElementById("empty");
    const globalQuery = document.getElementById("globalQuery");
    const addBtn = document.getElementById("addWindow");

    const PROXY_BASE = "/p?url=";
    const SEARCH_HOME = "https://duckduckgo.com/";
    const buildSearchUrl = (q) =>
      `${SEARCH_HOME}?q=${encodeURIComponent(q)}&ia=web`;

    function updateCount() {
      const n = grid.children.length;
      counter.textContent = n;
      empty.style.display = n ? "none" : "block";
    }

    function createWindow(initialQuery = "") {
      const card = document.createElement("div");
      card.className = "card";

      const head = document.createElement("div");
      head.className = "card-header";

      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = "ابحث داخل هذه النافذة...";
      input.value = initialQuery || "";

      const go = document.createElement("button");
      go.textContent = "بحث";

      const close = document.createElement("button");
      close.textContent = "إغلاق";
      close.style.background = "#f44336";

      const frame = document.createElement("iframe");
      frame.loading = "lazy";

      function load(query) {
        const url = query ? buildSearchUrl(query) : SEARCH_HOME;
        frame.src = PROXY_BASE + encodeURIComponent(url);
      }

      go.addEventListener("click", () => {
        const q = input.value.trim();
        load(q);
      });

      input.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          go.click();
        }
      });

      close.addEventListener("click", () => {
        grid.removeChild(card);
        updateCount();
      });

      head.append(input, go, close);
      card.append(head, frame);
      grid.append(card);
      updateCount();

      // حمّل الصفحة الأولية
      load(initialQuery);
    }

    addBtn.addEventListener("click", () => {
      createWindow(globalQuery.value.trim());
      globalQuery.value = "";
      globalQuery.focus();
    });

    // نافذة افتراضية واحدة
    createWindow("");
  </script>
</body>
</html>
