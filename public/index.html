<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>نوافذ بحث عبر البروكسي</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; background: #f5f7fb; }
header { position: sticky; top: 0; background: #fff; padding: 8px 12px; box-shadow: 0 2px 10px rgba(0,0,0,.06); z-index: 10; }
h1 { margin: 0; font-size: 16px; }
.controls { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
input[type="text"] { flex: 1; min-width: 180px; padding: 6px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; }
button { padding: 6px 10px; border: 0; border-radius: 8px; cursor: pointer; font-size: 12px; box-shadow: 0 2px 6px rgba(0,0,0,.08); }
.btn { background: #4caf50; color: #fff; }
.btn:hover { filter: brightness(0.95); }
.grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 8px; }
.card { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,.06); display: flex; flex-direction: column; }
.card-header { padding: 4px 6px; display: flex; gap: 4px; align-items: center; border-bottom: 1px solid #eee; }
.card-header input { flex: 1; min-width: 80px; font-size: 12px; padding: 4px; }
.card-header button { font-size: 12px; padding: 4px 8px; background: #2196f3; color: white; }
iframe { width: 100%; height: 250px; border: 0; }
.empty { text-align: center; color: #777; padding: 20px 0; }
</style>
</head>
<body>
<header>
  <h1>نوافذ بحث عبر البروكسي</h1>
  <div class="controls">
    <input id="globalQuery" type="text" placeholder="ابحث هنا أو ضع رابط" />
    <button class="btn" id="addWindow">فتح نافذة جديدة</button>
    <div id="count" style="margin-inline-start:auto;color:#555;">عدد النوافذ: <b id="cnum">0</b></div>
  </div>
</header>

<main>
  <div class="grid" id="grid"></div>
  <div class="empty" id="empty">لا توجد نوافذ بعد. اكتب كلمة بحث أو رابط واضغط "فتح نافذة جديدة".</div>
</main>

<script>
const grid = document.getElementById("grid");
const counter = document.getElementById("cnum");
const empty = document.getElementById("empty");
const globalQuery = document.getElementById("globalQuery");
const addBtn = document.getElementById("addWindow");

const PROXY_BASE = "/p?url=";
const SEARCH_HOME = "https://duckduckgo.com/";
const buildSearchUrl = (q) => `${SEARCH_HOME}?q=${encodeURIComponent(q)}&ia=web`;

function updateCount() {
  const n = grid.children.length;
  counter.textContent = n;
  empty.style.display = n ? "none" : "block";
}

function createWindow(initialQuery = "") {
  const card = document.createElement("div");
  card.className = "card";

  const head = document.createElement("div");
  head.className = "card-header";

  const input = document.createElement("input");
  input.type = "text";
  input.placeholder = "ابحث داخل هذه النافذة أو ضع رابط...";
  input.value = initialQuery || "";

  const go = document.createElement("button");
  go.textContent = "بحث";

  const close = document.createElement("button");
  close.textContent = "إغلاق";
  close.style.background = "#f44336";

  const frame = document.createElement("iframe");
  frame.loading = "lazy";

  function load(query) {
    let url;
    if (!query) {
      url = SEARCH_HOME;
    } else if (/^https?:\/\//i.test(query)) {
      url = query; // رابط كامل
    } else {
      url = buildSearchUrl(query); // نص للبحث
    }
    frame.src = PROXY_BASE + encodeURIComponent(url);
  }

  go.addEventListener("click", () => {
    const q = input.value.trim();
    load(q);
  });

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      go.click();
    }
  });

  close.addEventListener("click", () => {
    grid.removeChild(card);
    updateCount();
  });

  head.append(input, go, close);
  card.append(head, frame);
  grid.append(card);
  updateCount();

  load(initialQuery);
}

addBtn.addEventListener("click", () => {
  createWindow(globalQuery.value.trim());
  globalQuery.value = "";
  globalQuery.focus();
});

// نافذة افتراضية واحدة
createWindow("");
</script>
</body>
</html>
