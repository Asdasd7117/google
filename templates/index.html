<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chrome Sync Controller</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.1/socket.io.min.js"></script>
</head>
<body>
<h2>Chrome Sync Controller</h2>

<textarea id="textInput" rows="5" cols="50">{{ text }}</textarea>
<br><br>
<button id="syncButton">تشغيل المزامنة</button>

<script>
const socket = io();

// الزر لتشغيل/إيقاف المزامنة
let syncActive = false;
document.getElementById('syncButton').onclick = () => {
    syncActive = !syncActive;
    socket.emit('toggle_sync', syncActive);
    document.getElementById('syncButton').innerText = syncActive ? "إيقاف المزامنة" : "تشغيل المزامنة";
};

// إرسال النص عند تغييره
const textInput = document.getElementById('textInput');
textInput.addEventListener('input', () => {
    if (syncActive) {
        socket.emit('update_text', textInput.value);
    }
});

// استقبال النصوص المزامنة
socket.on('sync_text', (data) => {
    if (!textInput.matches(':focus')) {  // لا تغير النص أثناء الكتابة
        textInput.value = data;
    }
});

// استقبال حالة المزامنة من أي تبويب آخر
socket.on('sync_status', (status) => {
    syncActive = status;
    document.getElementById('syncButton').innerText = syncActive ? "إيقاف المزامنة" : "تشغيل المزامنة";
});
</script>
</body>
</html>
