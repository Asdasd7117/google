<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chrome Sync Web</title>
<script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
<style>
  iframe { width: 30%; height: 300px; margin: 5px; float: left; }
  #controls { clear: both; margin-top: 20px; }
</style>
</head>
<body>

<div id="iframes">
  {% for i in range(6) %}
  <iframe src="{{ url }}" id="tab{{ i }}"></iframe>
  {% endfor %}
</div>

<div id="controls">
  <input type="text" id="mainInput" placeholder="اكتب هنا…">
  <button id="syncButton">تشغيل المزامنة</button>
</div>

<script>
  const socket = io();
  let syncing = false;

  const input = document.getElementById("mainInput");
  const button = document.getElementById("syncButton");

  button.onclick = () => {
    syncing = !syncing;
    button.textContent = syncing ? "إيقاف المزامنة" : "تشغيل المزامنة";
    socket.emit('button_click', { syncing });
  };

  input.addEventListener("input", () => {
    if (syncing) {
      socket.emit('text_update', { text: input.value });
    }
  });

  // استقبال التغييرات من التبويبات الأخرى
  socket.on('update_text', data => {
    if (syncing && input.value !== data.text) {
      input.value = data.text;
    }
  });

  socket.on('sync_button', data => {
    syncing = data.syncing;
    button.textContent = syncing ? "إيقاف المزامنة" : "تشغيل المزامنة";
  });
</script>

</body>
</html>
