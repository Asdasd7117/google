<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chrome Tabs Sync</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
<h1>Chrome Tabs Sync</h1>
<input id="mainInput" placeholder="اكتب هنا ليتم المزامنة">
<button id="exampleBtn">زر المثال</button>
<button id="syncBtn">تفعيل المزامنة</button>

<script>
let tabs = [];
let syncActive = false;

// فتح 6 تبويبات جديدة
for(let i=0; i<6; i++){
    tabs.push(window.open(window.location.href, `tab${i}`));
}

const socket = io();

document.getElementById("syncBtn").addEventListener("click", () => {
    syncActive = !syncActive;
    document.getElementById("syncBtn").textContent = syncActive ? "ايقاف المزامنة" : "تفعيل المزامنة";
});

// مزامنة النصوص
document.getElementById("mainInput").addEventListener("input", (e) => {
    if(syncActive){
        socket.emit("sync_event", {type:"text", value:e.target.value});
    }
});

// مزامنة الزر
document.getElementById("exampleBtn").addEventListener("click", () => {
    if(syncActive){
        socket.emit("sync_event", {type:"click", id:"exampleBtn"});
    }
});

// استقبال التحديثات في باقي التبويبات
socket.on("update_tabs", (data) => {
    if(!syncActive) return;
    tabs.forEach(tab => {
        try {
            if(data.type==="text"){
                tab.document.getElementById("mainInput").value = data.value;
            } else if(data.type==="click"){
                tab.document.getElementById(data.id)?.click();
            }
        } catch {}
    });
});
</script>
</body>
</html>
