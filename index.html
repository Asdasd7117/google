<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Flutter Project Editor - Netlify</title>
<style>
body { font-family: Arial; margin:20px; }
textarea { width:100%; height:200px; }
ul { list-style:none; padding-left:20px; }
button { padding:5px 10px; margin-top:5px; margin-bottom:5px; }
.file-editor { width:100%; height:300px; margin-top:10px; }
</style>
</head>
<body>

<h2>إدخال هيكل المشروع نصياً</h2>
<textarea id="structureText" placeholder="الصق هنا الهيكل النصي للمشروع..."></textarea><br>
<button onclick="createProject()">إنشاء المشروع</button>

<h2>هيكل المشروع</h2>
<div id="fileTree"></div>

<h2>تحرير الملف</h2>
<div id="editorDiv" style="display:none;">
  <p>الملف: <span id="currentFile"></span></p>
  <textarea id="fileEditor" class="file-editor"></textarea><br>
  <button onclick="saveFile()">حفظ التعديلات</button>
</div>

<h2>ضغط المشروع</h2>
<button onclick="downloadZip()">إنشاء ZIP وتحميل</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.11.0/jszip.min.js"></script>
<script>
let project = {}; // هيكل المشروع
let currentFile = '';

function createProject() {
    const text = document.getElementById('structureText').value;
    const lines = text.split('\n');
    project = {};
    const stack = [{obj: project, level:-1}];

    lines.forEach(line=>{
        if(!line.trim()) return;
        const spaces = line.match(/^\s*/)[0].length;
        const name = line.trim();
        while(stack.length && stack[stack.length-1].level >= spaces) stack.pop();
        const parent = stack[stack.length-1].obj;
        if(name.endsWith('/') || !name.includes('.')) parent[name.replace(/\/$/,'')] = {};
        else parent[name] = '';
        if(name.endsWith('/') || !name.includes('.')) stack.push({obj: parent[name.replace(/\/$/,'')], level:spaces});
    });
    renderTree();
}

function renderTree() {
    const container = document.getElementById('fileTree');
    container.innerHTML = '';
    function buildTree(obj, path='') {
        const ul = document.createElement('ul');
        for(const key in obj) {
            const li = document.createElement('li');
            if(typeof obj[key]==='object') {
                li.innerHTML = `<strong>${key}/</strong>`;
                li.appendChild(buildTree(obj[key], path + key + '/'));
            } else {
                const btn = document.createElement('button');
                btn.textContent = key;
                btn.onclick = ()=>openFile(path + key);
                li.appendChild(btn);
            }
            ul.appendChild(li);
        }
        return ul;
    }
    container.appendChild(buildTree(project));
}

function openFile(path) {
    currentFile = path;
    document.getElementById('editorDiv').style.display='block';
    document.getElementById('currentFile').textContent = path;
    const parts = path.split('/');
    let obj = project;
    for(let i=0;i<parts.length;i++){
        obj = obj[parts[i]];
    }
    document.getElementById('fileEditor').value = obj;
}

function saveFile() {
    const parts = currentFile.split('/');
    let obj = project;
    for(let i=0;i<parts.length-1;i++) obj = obj[parts[i]];
    obj[parts[parts.length-1]] = document.getElementById('fileEditor').value;
    alert('تم حفظ التعديلات!');
}

function downloadZip() {
    const zip = new JSZip();
    function addFiles(obj, folder) {
        for(const key in obj) {
            if(typeof obj[key]==='object') {
                const sub = folder.folder(key);
                addFiles(obj[key], sub);
            } else {
                folder.file(key, obj[key]);
            }
        }
    }
    addFiles(project, zip);
    zip.generateAsync({type:"blob"}).then(function(content){
        const a = document.createElement('a');
        a.href = URL.createObjectURL(content);
        a.download = "project.zip";
        a.click();
    });
}
</script>
</body>
</html>
